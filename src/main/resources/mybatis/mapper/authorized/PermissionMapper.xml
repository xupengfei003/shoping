<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="so.sao.shop.supplier.dao.authorized.PermissionDao">

    <resultMap id="PermissionResultMap" type="so.sao.shop.supplier.domain.authorized.Permission">
        <id column="id" jdbcType="BIGINT" property="id"/>
        <result column="code" jdbcType="INTEGER" property="code"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="type" jdbcType="INTEGER" property="type"/>
        <result column="url" jdbcType="VARCHAR" property="url"/>
        <result column="description" jdbcType="VARCHAR" property="description"/>
    </resultMap>
    
    <insert id="insert" parameterType="so.sao.shop.supplier.domain.authorized.Permission">
		INSERT INTO permission(
			        id,
			        name,
			        url,
			        description,
			        code,
			        type
			   )VALUES(
					#{id},
					#{name},
					#{url},
					#{description},
					#{code},
					#{type}
			   )
	</insert>

    <select id="findAll" resultMap="PermissionResultMap">
        SELECT * FROM permission
    </select>

    <select id="findByUserId" parameterType="Long" resultMap="PermissionResultMap">  
		SELECT
			p.id,
			p.name,
			p.url,
			p.description
		FROM
			USER u,
			user_roles ur,
			role r,
			role_permission rp,
			permission p
		WHERE
			u.user_id = ur.user_id
		AND ur.role_id = r.id
		AND rp.role_id = r.id
		AND p.id = rp.per_id
		AND u.user_id = #{userId}
    </select>

</mapper>